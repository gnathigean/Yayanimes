<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste da API - YayaAnimes</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        padding: 40px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }
      h1 {
        color: #667eea;
        margin-bottom: 10px;
        text-align: center;
      }
      .subtitle {
        text-align: center;
        color: #666;
        margin-bottom: 40px;
      }
      .btn-group {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
      }
      button {
        padding: 15px 25px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        color: white;
      }
      .btn-primary {
        background: #667eea;
      }
      .btn-primary:hover {
        background: #5568d3;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }
      .btn-success {
        background: #10b981;
      }
      .btn-success:hover {
        background: #059669;
        transform: translateY(-2px);
      }
      .btn-info {
        background: #3b82f6;
      }
      .btn-info:hover {
        background: #2563eb;
        transform: translateY(-2px);
      }
      .btn-warning {
        background: #f59e0b;
      }
      .btn-warning:hover {
        background: #d97706;
        transform: translateY(-2px);
      }
      .result-box {
        background: #f9fafb;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        padding: 20px;
        margin-top: 20px;
        max-height: 600px;
        overflow-y: auto;
        display: none;
      }
      .result-box.show {
        display: block;
      }
      .result-box h3 {
        color: #667eea;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .result-box pre {
        background: #1e293b;
        color: #e5e7eb;
        padding: 20px;
        border-radius: 8px;
        overflow-x: auto;
        font-size: 13px;
        line-height: 1.6;
      }
      .status {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 12px;
        font-size: 13px;
        font-weight: 600;
        margin-left: auto;
      }
      .status-success {
        background: #d1fae5;
        color: #065f46;
      }
      .status-error {
        background: #fee2e2;
        color: #991b1b;
      }
      .loading {
        display: none;
        text-align: center;
        padding: 40px;
      }
      .loading.active {
        display: block;
      }
      .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid rgba(102, 126, 234, 0.2);
        border-top-color: #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }
      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
      }
      .stat-value {
        font-size: 36px;
        font-weight: 700;
        margin-bottom: 8px;
      }
      .stat-label {
        font-size: 14px;
        opacity: 0.9;
      }
      .anime-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }
      .anime-card {
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .anime-card img {
        width: 100%;
        aspect-ratio: 2/3;
        object-fit: cover;
      }
      .anime-card-title {
        padding: 10px;
        font-size: 13px;
        font-weight: 600;
        color: #333;
        text-align: center;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üß™ Teste da API YayaAnimes</h1>
      <p class="subtitle">Valide todos os endpoints da API falcon71181</p>

      <div class="stats" id="stats" style="display: none">
        <div class="stat-card">
          <div class="stat-value" id="stat-success">0</div>
          <div class="stat-label">‚úÖ Testes com Sucesso</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-error">0</div>
          <div class="stat-label">‚ùå Erros Encontrados</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-time">0ms</div>
          <div class="stat-label">‚è±Ô∏è Tempo M√©dio</div>
        </div>
      </div>

      <div class="btn-group">
        <button class="btn-primary" onclick="testHomepage()">
          üè† Testar Homepage
        </button>
        <button class="btn-success" onclick="testSearch()">
          üîç Testar Busca
        </button>
        <button class="btn-info" onclick="testAnimeInfo()">
          üì∫ Testar Info Anime
        </button>
        <button class="btn-warning" onclick="testFullFlow()">
          üöÄ Teste Completo
        </button>
      </div>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p style="font-size: 18px; color: #667eea; font-weight: 600">
          Testando API...
        </p>
      </div>

      <div class="result-box" id="result">
        <h3>
          <span id="result-icon">üìä</span>
          <span id="result-title">Resultado</span>
          <span id="result-status" class="status"></span>
        </h3>
        <div id="result-content"></div>
      </div>
    </div>

    <script src="api-service.js"></script>
    <script>
      let stats = { success: 0, error: 0, times: [] };

      function showLoading() {
        document.getElementById("loading").classList.add("active");
        document.getElementById("result").classList.remove("show");
      }

      function hideLoading() {
        document.getElementById("loading").classList.remove("active");
      }

      function showResult(title, content, isSuccess = true, icon = "üìä") {
        hideLoading();
        document.getElementById("stats").style.display = "grid";
        document.getElementById("result").classList.add("show");
        document.getElementById("result-icon").textContent = icon;
        document.getElementById("result-title").textContent = title;

        const statusEl = document.getElementById("result-status");
        statusEl.className = `status ${
          isSuccess ? "status-success" : "status-error"
        }`;
        statusEl.textContent = isSuccess ? "‚úÖ SUCESSO" : "‚ùå ERRO";

        document.getElementById("result-content").innerHTML = content;

        if (isSuccess) {
          stats.success++;
        } else {
          stats.error++;
        }
        updateStats();
      }

      function updateStats() {
        document.getElementById("stat-success").textContent = stats.success;
        document.getElementById("stat-error").textContent = stats.error;

        const avgTime =
          stats.times.length > 0
            ? Math.round(
                stats.times.reduce((a, b) => a + b, 0) / stats.times.length
              )
            : 0;
        document.getElementById("stat-time").textContent = avgTime + "ms";
      }

      async function testHomepage() {
        showLoading();
        const startTime = Date.now();

        try {
          const response = await window.AnimeAPI.loadContentForHomepage();
          const duration = Date.now() - startTime;
          stats.times.push(duration);

          const data = response.data;

          let content = `<pre>${JSON.stringify(response, null, 2).substring(
            0,
            2000
          )}...</pre>`;

          if (data.spotlightAnimes && data.spotlightAnimes.length > 0) {
            content = `
              <p style="margin-bottom: 15px; color: #10b981; font-weight: 600;">
                ‚úÖ API funcionando! Encontrados ${
                  data.spotlightAnimes.length
                } animes em destaque
              </p>
              <div class="anime-grid">
                ${data.spotlightAnimes
                  .slice(0, 6)
                  .map(
                    (anime) => `
                  <div class="anime-card">
                    <img src="${anime.poster}" alt="${anime.name}" onerror="this.src='https://via.placeholder.com/150x225?text=No+Image'">
                    <div class="anime-card-title">${anime.name}</div>
                  </div>
                `
                  )
                  .join("")}
              </div>
              <details style="margin-top: 20px;">
                <summary style="cursor: pointer; color: #667eea; font-weight: 600; margin-bottom: 10px;">Ver JSON completo</summary>
                <pre>${JSON.stringify(response, null, 2)}</pre>
              </details>
            `;
          }

          showResult(`Homepage (${duration}ms)`, content, true, "üè†");
        } catch (error) {
          const duration = Date.now() - startTime;
          showResult(
            "Homepage - ERRO",
            `<pre style="color: #ef4444;">${error.message}</pre>`,
            false,
            "‚ùå"
          );
        }
      }

      async function testSearch() {
        showLoading();
        const startTime = Date.now();

        try {
          const response = await window.AnimeAPI.searchAnimes("naruto", 1);
          const duration = Date.now() - startTime;
          stats.times.push(duration);

          const animes = response.data?.animes || [];

          let content = `
            <p style="margin-bottom: 15px; color: #10b981; font-weight: 600;">
              ‚úÖ Busca funcionando! Encontrados ${animes.length} resultados para "naruto"
            </p>
          `;

          if (animes.length > 0) {
            content += `
              <div class="anime-grid">
                ${animes
                  .slice(0, 6)
                  .map(
                    (anime) => `
                  <div class="anime-card">
                    <img src="${anime.poster}" alt="${anime.name}" onerror="this.src='https://via.placeholder.com/150x225?text=No+Image'">
                    <div class="anime-card-title">${anime.name}</div>
                  </div>
                `
                  )
                  .join("")}
              </div>
            `;
          }

          content += `
            <details style="margin-top: 20px;">
              <summary style="cursor: pointer; color: #667eea; font-weight: 600; margin-bottom: 10px;">Ver JSON completo</summary>
              <pre>${JSON.stringify(response, null, 2)}</pre>
            </details>
          `;

          showResult(`Busca (${duration}ms)`, content, true, "üîç");
        } catch (error) {
          const duration = Date.now() - startTime;
          showResult(
            "Busca - ERRO",
            `<pre style="color: #ef4444;">${error.message}</pre>`,
            false,
            "‚ùå"
          );
        }
      }

      async function testAnimeInfo() {
        showLoading();
        const startTime = Date.now();

        try {
          const response = await window.AnimeAPI.getAnimeInfo("one-piece-100");
          const duration = Date.now() - startTime;
          stats.times.push(duration);

          const anime =
            response.data?.anime?.info || response.data?.anime || {};

          let content = `
            <div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">
              <img src="${anime.poster}" alt="${
            anime.name
          }" style="width: 200px; height: 300px; object-fit: cover; border-radius: 8px;" onerror="this.src='https://via.placeholder.com/200x300?text=No+Image'">
              <div style="flex: 1; min-width: 300px;">
                <h3 style="color: #667eea; margin-bottom: 10px;">${
                  anime.name || "Sem t√≠tulo"
                }</h3>
                <p style="color: #666; margin-bottom: 10px;"><strong>Rating:</strong> ${
                  anime.rating || "N/A"
                }</p>
                <p style="color: #666; margin-bottom: 10px;"><strong>Status:</strong> ${
                  anime.stats?.status || "N/A"
                }</p>
                <p style="color: #666; line-height: 1.6;">${
                  anime.description || "Sem descri√ß√£o"
                }</p>
              </div>
            </div>
            <details>
              <summary style="cursor: pointer; color: #667eea; font-weight: 600; margin-bottom: 10px;">Ver JSON completo</summary>
              <pre>${JSON.stringify(response, null, 2)}</pre>
            </details>
          `;

          showResult(`Info do Anime (${duration}ms)`, content, true, "üì∫");
        } catch (error) {
          const duration = Date.now() - startTime;
          showResult(
            "Info do Anime - ERRO",
            `<pre style="color: #ef4444;">${error.message}</pre>`,
            false,
            "‚ùå"
          );
        }
      }

      async function testFullFlow() {
        stats = { success: 0, error: 0, times: [] };
        showLoading();

        try {
          await testHomepage();
          await new Promise((resolve) => setTimeout(resolve, 1000));
          await testSearch();
          await new Promise((resolve) => setTimeout(resolve, 1000));
          await testAnimeInfo();

          showResult(
            "üéâ TESTE COMPLETO - SUCESSO!",
            `
              <div style="text-align: center; padding: 20px;">
                <p style="font-size: 20px; color: #10b981; font-weight: 700; margin-bottom: 15px;">
                  Todos os testes foram executados com sucesso! üéä
                </p>
                <p style="color: #666; margin-bottom: 20px;">
                  A API est√° funcionando perfeitamente e pronta para uso.
                </p>
                <div style="background: #f0fdf4; border: 2px solid #86efac; border-radius: 8px; padding: 15px; margin-top: 20px;">
                  <p style="color: #166534; font-weight: 600;">üìã Resumo dos Testes:</p>
                  <ul style="text-align: left; color: #166534; margin: 10px 0; padding-left: 20px;">
                    <li>‚úÖ Homepage carregada com sucesso</li>
                    <li>‚úÖ Busca funcionando corretamente</li>
                    <li>‚úÖ Informa√ß√µes dos animes sendo retornadas</li>
                    <li>‚úÖ Total de ${stats.success} testes bem-sucedidos</li>
                    <li>‚úÖ Tempo m√©dio de resposta: ${Math.round(
                      stats.times.reduce((a, b) => a + b, 0) /
                        stats.times.length
                    )}ms</li>
                  </ul>
                </div>
              </div>
            `,
            true,
            "üéâ"
          );
        } catch (error) {
          showResult(
            "Teste Completo - ERRO",
            `<pre style="color: #ef4444;">${error.message}</pre>`,
            false,
            "‚ùå"
          );
        }
      }

      // Auto-test na inicializa√ß√£o
      window.addEventListener("load", () => {
        setTimeout(() => {
          console.log("üß™ Iniciando teste autom√°tico da API...");
          testHomepage();
        }, 500);
      });
    </script>
  </body>
</html>
