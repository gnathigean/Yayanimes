<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste da API - falcon71181</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }
      .container {
        max-width: 1000px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        padding: 30px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }
      h1 {
        color: #667eea;
        margin-bottom: 10px;
        text-align: center;
      }
      .subtitle {
        text-align: center;
        color: #666;
        margin-bottom: 30px;
      }
      .input-group {
        margin-bottom: 20px;
      }
      label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
        color: #333;
      }
      input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 16px;
        transition: border 0.3s;
      }
      input:focus {
        outline: none;
        border-color: #667eea;
      }
      .btn-group {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
        margin-bottom: 30px;
      }
      button {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        color: white;
      }
      .btn-primary {
        background: #667eea;
      }
      .btn-primary:hover {
        background: #5568d3;
        transform: translateY(-2px);
      }
      .btn-success {
        background: #10b981;
      }
      .btn-success:hover {
        background: #059669;
        transform: translateY(-2px);
      }
      .btn-info {
        background: #3b82f6;
      }
      .btn-info:hover {
        background: #2563eb;
        transform: translateY(-2px);
      }
      .btn-warning {
        background: #f59e0b;
      }
      .btn-warning:hover {
        background: #d97706;
        transform: translateY(-2px);
      }
      .result-box {
        background: #f9fafb;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        max-height: 500px;
        overflow-y: auto;
      }
      .result-box h3 {
        color: #667eea;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .result-box pre {
        background: #1e293b;
        color: #e5e7eb;
        padding: 15px;
        border-radius: 8px;
        overflow-x: auto;
        font-size: 12px;
        line-height: 1.6;
      }
      .status {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
      }
      .status-success {
        background: #d1fae5;
        color: #065f46;
      }
      .status-error {
        background: #fee2e2;
        color: #991b1b;
      }
      .status-loading {
        background: #dbeafe;
        color: #1e40af;
      }
      .loading {
        display: none;
        text-align: center;
        padding: 20px;
      }
      .loading.active {
        display: block;
      }
      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid rgba(102, 126, 234, 0.2);
        border-top-color: #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }
      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }
      .stat-value {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 5px;
      }
      .stat-label {
        font-size: 12px;
        opacity: 0.9;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üß™ Teste da API falcon71181</h1>
      <p class="subtitle">Valide todos os endpoints da sua API</p>

      <div class="input-group">
        <label for="api-url">üîó URL da sua API no Vercel</label>
        <input
          type="text"
          id="api-url"
          placeholder="https://seu-deploy.vercel.app"
          value="https://api-anime-rouge.vercel.app"
        />
      </div>

      <div class="stats" id="stats" style="display: none">
        <div class="stat-card">
          <div class="stat-value" id="stat-success">0</div>
          <div class="stat-label">‚úÖ Sucesso</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-error">0</div>
          <div class="stat-label">‚ùå Erros</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-time">0ms</div>
          <div class="stat-label">‚è±Ô∏è Tempo M√©dio</div>
        </div>
      </div>

      <div class="btn-group">
        <button class="btn-primary" onclick="testHomepage()">
          üè† Testar Homepage
        </button>
        <button class="btn-success" onclick="testSearch()">
          üîç Testar Busca
        </button>
        <button class="btn-info" onclick="testAnimeInfo()">
          üì∫ Testar Info Anime
        </button>
        <button class="btn-warning" onclick="testFullFlow()">
          üöÄ Teste Completo
        </button>
      </div>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Testando API...</p>
      </div>

      <div class="result-box" id="result" style="display: none">
        <h3>
          <span id="result-icon">üìä</span>
          <span id="result-title">Resultado</span>
          <span id="result-status"></span>
        </h3>
        <pre id="result-content"></pre>
      </div>
    </div>

    <script>
      let stats = { success: 0, error: 0, times: [] };

      function getApiUrl() {
        return document.getElementById("api-url").value.trim();
      }

      function showLoading() {
        document.getElementById("loading").classList.add("active");
        document.getElementById("result").style.display = "none";
      }

      function hideLoading() {
        document.getElementById("loading").classList.remove("active");
      }

      function showResult(title, data, isSuccess = true, icon = "üìä") {
        hideLoading();
        document.getElementById("stats").style.display = "grid";
        document.getElementById("result").style.display = "block";
        document.getElementById("result-icon").textContent = icon;
        document.getElementById("result-title").textContent = title;

        const statusEl = document.getElementById("result-status");
        statusEl.className = `status ${
          isSuccess ? "status-success" : "status-error"
        }`;
        statusEl.textContent = isSuccess ? "‚úÖ SUCESSO" : "‚ùå ERRO";

        document.getElementById("result-content").textContent = JSON.stringify(
          data,
          null,
          2
        );

        if (isSuccess) {
          stats.success++;
        } else {
          stats.error++;
        }
        updateStats();
      }

      function updateStats() {
        document.getElementById("stat-success").textContent = stats.success;
        document.getElementById("stat-error").textContent = stats.error;

        const avgTime =
          stats.times.length > 0
            ? Math.round(
                stats.times.reduce((a, b) => a + b, 0) / stats.times.length
              )
            : 0;
        document.getElementById("stat-time").textContent = avgTime + "ms";
      }

      async function testEndpoint(endpoint, title, icon) {
        showLoading();
        const apiUrl = getApiUrl();
        const url = `${apiUrl}${endpoint}`;

        console.log("üß™ Testando:", url);

        const startTime = Date.now();

        try {
          const response = await fetch(url);
          const endTime = Date.now();
          const duration = endTime - startTime;
          stats.times.push(duration);

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();

          showResult(
            `${title} (${duration}ms)`,
            {
              url,
              status: response.status,
              data: data,
            },
            true,
            icon
          );

          return data;
        } catch (error) {
          const endTime = Date.now();
          const duration = endTime - startTime;

          showResult(
            `${title} - ERRO`,
            {
              url,
              error: error.message,
              duration: duration + "ms",
            },
            false,
            "‚ùå"
          );

          throw error;
        }
      }

      async function testHomepage() {
        await testEndpoint("/aniwatch/", "Homepage", "üè†");
      }

      async function testSearch() {
        await testEndpoint(
          "/aniwatch/search?keyword=naruto&page=1",
          "Busca (Naruto)",
          "üîç"
        );
      }

      async function testAnimeInfo() {
        await testEndpoint(
          "/aniwatch/anime/one-piece-100",
          "Info do Anime (One Piece)",
          "üì∫"
        );
      }

      async function testFullFlow() {
        stats = { success: 0, error: 0, times: [] };

        try {
          showLoading();

          // 1. Homepage
          console.log("1Ô∏è‚É£ Testando Homepage...");
          const homepage = await testEndpoint(
            "/aniwatch/",
            "Passo 1: Homepage",
            "1Ô∏è‚É£"
          );
          await sleep(1000);

          // 2. Busca
          console.log("2Ô∏è‚É£ Testando Busca...");
          const search = await testEndpoint(
            "/aniwatch/search?keyword=solo&page=1",
            "Passo 2: Busca",
            "2Ô∏è‚É£"
          );
          await sleep(1000);

          // 3. Pegar primeiro anime da busca
          const firstAnime = search.animes?.[0];
          if (!firstAnime) {
            throw new Error("Nenhum anime encontrado na busca");
          }

          console.log("3Ô∏è‚É£ Testando Info do Anime...");
          const animeInfo = await testEndpoint(
            `/aniwatch/anime/${firstAnime.id}`,
            "Passo 3: Info do Anime",
            "3Ô∏è‚É£"
          );
          await sleep(1000);

          // 4. Epis√≥dios
          console.log("4Ô∏è‚É£ Testando Epis√≥dios...");
          const episodes = await testEndpoint(
            `/aniwatch/episodes/${firstAnime.id}`,
            "Passo 4: Epis√≥dios",
            "4Ô∏è‚É£"
          );
          await sleep(1000);

          // 5. Servidores
          const firstEpisode = episodes.episodes?.[0];
          if (!firstEpisode) {
            throw new Error("Nenhum epis√≥dio encontrado");
          }

          console.log("5Ô∏è‚É£ Testando Servidores...");
          const servers = await testEndpoint(
            `/aniwatch/servers?id=${encodeURIComponent(
              firstEpisode.episodeId
            )}`,
            "Passo 5: Servidores",
            "5Ô∏è‚É£"
          );
          await sleep(1000);

          // 6. Streams
          const firstServer = servers.sub?.[0];
          if (!firstServer) {
            throw new Error("Nenhum servidor dispon√≠vel");
          }

          console.log("6Ô∏è‚É£ Testando Streams...");
          await testEndpoint(
            `/aniwatch/episode-srcs?id=${encodeURIComponent(
              firstEpisode.episodeId
            )}&server=${firstServer.serverName}&category=sub`,
            "Passo 6: Streams",
            "6Ô∏è‚É£"
          );

          // Resumo final
          showResult(
            "üéâ TESTE COMPLETO - SUCESSO!",
            {
              message: "Todos os endpoints funcionando perfeitamente!",
              summary: {
                totalTests: 6,
                success: stats.success,
                errors: stats.error,
                averageTime:
                  Math.round(
                    stats.times.reduce((a, b) => a + b, 0) / stats.times.length
                  ) + "ms",
              },
            },
            true,
            "üéâ"
          );
        } catch (error) {
          showResult(
            "Teste Completo - ERRO",
            {
              message: "Falha no fluxo completo",
              error: error.message,
              step: stats.success + 1,
            },
            false,
            "‚ùå"
          );
        }
      }

      function sleep(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }

      // Auto-test on load (opcional)
      // window.addEventListener('load', () => {
      //   setTimeout(testHomepage, 1000);
      // });
    </script>
  </body>
</html>
