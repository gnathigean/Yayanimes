<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste SugoiAPI</title>
    <style>
      body {
        font-family: monospace;
        background: #1a1a1a;
        color: #00ff00;
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
      }
      button {
        background: #00ff00;
        color: #1a1a1a;
        border: none;
        padding: 10px 20px;
        margin: 5px;
        cursor: pointer;
        font-family: monospace;
        font-weight: bold;
      }
      button:hover {
        background: #00cc00;
      }
      pre {
        background: #000;
        padding: 15px;
        border-radius: 5px;
        overflow-x: auto;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      .success {
        color: #00ff00;
      }
      .error {
        color: #ff0000;
      }
      .info {
        color: #00ccff;
      }
    </style>
  </head>
  <body>
    <h1>🧪 Teste da SugoiAPI</h1>

    <div>
      <button onclick="testPopular()">📊 Testar /popular</button>
      <button onclick="testRecent()">🆕 Testar /recent</button>
      <button onclick="testSearch()">🔍 Testar /search</button>
      <button onclick="testInfo()">ℹ️ Testar /info</button>
      <button onclick="clearResults()">🗑️ Limpar</button>
    </div>

    <div id="results"></div>

    <script>
      const BASE_URL = "https://sugoi-api.vercel.app/anime";
      const resultsDiv = document.getElementById("results");

      function log(message, type = "info") {
        const p = document.createElement("p");
        p.className = type;
        p.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        resultsDiv.appendChild(p);
      }

      function showJSON(title, data) {
        const pre = document.createElement("pre");
        pre.innerHTML = `<strong class="info">${title}</strong>\n${JSON.stringify(
          data,
          null,
          2
        )}`;
        resultsDiv.appendChild(pre);
      }

      async function makeRequest(endpoint) {
        const url = `${BASE_URL}${endpoint}`;
        log(`🌐 Requisição: ${url}`);

        try {
          const response = await fetch(url);

          log(
            `📡 Status: ${response.status} ${response.statusText}`,
            response.ok ? "success" : "error"
          );

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }

          const data = await response.json();

          log(`✅ Dados recebidos!`, "success");
          log(`📦 Tipo: ${typeof data}`);
          log(`📦 É Array: ${Array.isArray(data)}`);

          if (Array.isArray(data)) {
            log(`📊 Total de itens: ${data.length}`);
          } else {
            log(`🔑 Propriedades: ${Object.keys(data).join(", ")}`);
            if (data.results) {
              log(`📊 Total em results: ${data.results.length}`);
            }
          }

          showJSON("Dados Completos:", data);

          // Mostrar primeiro item se for array
          if (Array.isArray(data) && data.length > 0) {
            showJSON("Primeiro Item:", data[0]);
          } else if (data.results && data.results.length > 0) {
            showJSON("Primeiro Item em results:", data.results[0]);
          }

          return data;
        } catch (error) {
          log(`❌ Erro: ${error.message}`, "error");
          console.error(error);
        }
      }

      async function testPopular() {
        clearResults();
        log("🧪 Testando endpoint /popular", "info");
        await makeRequest("/popular?page=1");
      }

      async function testRecent() {
        clearResults();
        log("🧪 Testando endpoint /recent", "info");
        await makeRequest("/recent?page=1");
      }

      async function testSearch() {
        clearResults();
        log("🧪 Testando endpoint /search", "info");
        await makeRequest("/search?query=naruto");
      }

      async function testInfo() {
        clearResults();
        log("🧪 Testando endpoint /info", "info");
        log("⚠️ Nota: Você precisa de um ID válido", "info");

        // Primeiro buscar um anime para pegar o ID
        log("🔍 Buscando animes populares para pegar um ID...", "info");
        const popular = await makeRequest("/popular?page=1");

        if (popular && (popular[0] || popular.results?.[0])) {
          const anime = popular[0] || popular.results[0];
          const animeId = anime.id;

          log(`📝 Testando /info com ID: ${animeId}`, "info");
          await makeRequest(`/info/${animeId}`);
        }
      }

      function clearResults() {
        resultsDiv.innerHTML = "";
      }

      // Teste automático ao carregar
      window.addEventListener("load", () => {
        log("🚀 Página carregada. Clique nos botões para testar!", "success");
        log(`🔗 API Base URL: ${BASE_URL}`, "info");
      });
    </script>
  </body>
</html>
